pw.loader.using(["pokemon.js","pokemon.7.js"],function(){function rearrangeBaseStats(a){return[a[0],a[1],a[2],a[4],a[5],a[3]]}function CalcIV(a,b,c,d,e,f){if(!(digit.test(b)&&digit.test(e)&&digit.test(c)&&digit.test(d)))return minIVs[a]=-1,void(maxIVs[a]=-1);if(b=parseInt(b),c=parseInt(c),d=parseInt(d),e=parseInt(e),0==b||0==c||0==e)return minIVs[a]=-1,void(maxIVs[a]=-1);if(1==c)return minIVs[a]=0,void(maxIVs[a]=31);var g=BackCalc(b,c,d,e,f),h=g<0?0:g,j=g>31?31:g;for(i=g+1;i<=31;i++)CalcStat(b,c,d,i,f)==e?j++:i=31;for(i=g-1;i>=0;i--)CalcStat(b,c,d,i,f)==e?h--:i=0;if(h>31||j<0||h<0||j>31)return minIVs[a]=-1,void(maxIVs[a]=-1);minIVs[a]=h,maxIVs[a]=j}function BackCalc(a,b,c,d,e){return 0==e||void 0==e?Math.ceil(100*(d-a-10)/a-2*b-Math.floor(c/4)):Math.ceil(100*(Math.ceil(d/e)-5)/a-2*b-Math.floor(c/4))}function CalcStat(a,b,c,d,e){if(0==a)return 0;if(0==b)return 0;if(1==b)return 1;a=parseInt(a),b=parseInt(b),c=parseInt(c);var f;return 0==e||void 0==e?f=Math.floor((2*b+d+Math.floor(c/4))*a/100+10+a):(f=Math.floor((2*b+d+Math.floor(c/4))*a/100+5),f=Math.floor(f*e)),f}function YtoX(a){return[a[0],a[1],a[2],a[5],a[3],a[4]]}function XtoY(a){return[a[0],a[1],a[2],a[4],a[5],a[3]]}function CalcHPType(a){for(var b=0,c=0;c<=5;c++)a[c]%2==1&&(b+=HP_Value[c]);return Math.floor(15*b/63)+1}function CalcHPPower(a){for(var b=0,c=0;c<=5;c++)a[c]%4>=2&&(b+=HP_Value[c]);return Math.floor(40*b/63)+30}function CheckCHR(a,b,c){var d=Math.max.apply({},a);return a[b]==d&&d%5==c}var COLORNAMES=["red","blue","yellow","green","black","brown","purple","gray","white","pink"];mw.util.addCSS(".pw-jscontent input[type=text] {\ttext-align:right;\twidth:50px;\tborder:0px;}.pw-jscontent td.input{\tborder-width:2px !important;}.pw-jscontent td.input, td.select {\tpadding:0px !important;}");var table="";for(table+='<table class="colortable colortable-colsep-1 colortable-rowsep-1 colorize " id="calc" style="text-align:center;width:560px">',table+='<tr><th style="width:200px">精灵</td><th style="width:50px">能力</td><th>种族值</td><th>努力值</td><th>性格</td><th>能力值</td><th style="width:50px">个体值</td></tr>',i=0;i<=5;i++)table+="<tr>",0==i&&(table+='<td id="Sprite" rowspan="6">&nbsp;</td>'),table+="<td>"+["HP","攻击","防御","特攻","特防","速度"][i]+"</td>",table+='<td class="input"><input type="text" class="BS" value="0" maxlength="3" onkeyup="CalcSingle('+i+');"></td>',table+='<td class="input"><input type="text" class="EV" value="0" maxlength="3" onkeyup="CalcSingle('+i+');"></td>',table+=0==i?'<td style="font-size:90%">＋　－</td>':'<td><input type="radio" class="Nature1" name="NatureP" onclick="CalcAll();" value="'+(i-1)+'"><input type="radio" class="Nature2" name="NatureM" onclick="CalcAll();" value="'+(i-1)+'"></td>',table+='<td class="input"><input type="text" class="Stat" maxlength="3" onkeyup="CalcSingle('+i+');"></td>',table+='<td class="IV">&nbsp;</td></tr>';table+='<tr><td class="select">',table+='<select id="pokemon" onChange="SelectPokemon(value)" style="width:120px">',table+="</select>",table+='<select id="form" onChange="SelectForm(value)" style="width:70px"></select>',table+="</td>",table+='<td>等级</td><td class="input"><input type="text" id="LV" value="1" maxlength="3" onkeyup="CalcAll();"></td>',table+='<td class="select"><select onChange="SelectEVs(value)">',table+='<option value="0/0/0/0/0/0" selected>全0</option>',table+='<option value="252/0/0/0/0/252">HPSP</option>',table+='<option value="0/252/0/0/0/252">ATSP</option>',table+='<option value="0/0/0/252/0/252">SASP</option>',table+='<option value="252/0/252/0/0/0">HPDF</option>',table+='<option value="252/0/0/0/252/0">HPSD</option>',table+='<option value="0/0/252/0/252/0">DFSD</option>',table+='<option value="252/252/252/252/252/252">全满</option>',table+="</select></td>",table+='<td class="select"><select onChange="SelectNature(value)">';for(var n_v=["0/0","0/0","0/1","0/2","0/3","0/4","0/0","1/0","1/1","1/2","1/3","1/4","0/0","2/0","2/1","2/2","2/3","2/4","0/0","3/0","3/1","3/2","3/3","3/4","0/0","4/0","4/1","4/2","4/3","4/4"],n_n=["----","努力","寂寞","固执","顽皮","勇敢","----","大胆","坦率","淘气","无虑","悠闲","----","谨慎","温和","腼腆","马虎","冷静","----","安静","温顺","慎重","浮躁","傲慢","----","胆小","急躁","开朗","天真","认真"],i=0;i<n_v.length;i++)table+='<option value="'+n_v[i]+'">'+n_n[i]+"</option>";table+='</select></td><td id="HP">&nbsp;</td><td id="IV_SUM" style="padding:0;font-size:88%">&nbsp;</td></tr>',table+="<tr><th colspan=7><hr/></th></tr>",table+='<tr class="advance"><th>个性</th><th colspan=6 style="padding:0"><select id="Characteristic" style=width:100% onChange="CreateURL()" >',n_v=["","0/0","0/1","0/2","0/3","0/4","0/5","1/0","1/1","1/2","1/3","1/4","1/5","2/0","2/1","2/2","2/3","2/4","2/5","3/0","3/1","3/2","3/3","3/4","3/5","4/0","4/1","4/2","4/3","4/4","4/5"],n_n=["","非常贪吃","以力量自豪","身体结实","喜欢奔跑","好奇心强","心意坚定","经常午睡（HP个体值31对应个性）","喜欢乱闹（攻击个体值31对应个性）","很耐打（防御个体值31对应个性）","对动静很敏感（速度个体值31对应个性）","喜欢恶作剧（特攻个体值31对应个性）","有点爱虚荣（特防个体值31对应个性）","常常打盹","有点易怒","韧性高","轻浮冒失","顾虑周全","很不服输","经常弄乱东西","喜欢吵架","耐性强","容易自满","思虑很多","好强","喜欢悠闲","容易激动","忍耐力强","逃跑很快","一丝不苟","有点顽固"];for(var i=0;i<n_v.length;i++)table+='<option value="'+n_v[i]+'">'+n_n[i]+"</option>";table+="</select></th></tr>",table+='<tr class="advance"><th>觉醒力量</th><th colspan=6 style="padding:0"><select id="HPType" style=width:100% onChange="CreateURL()"><option selected> </option>';for(var i=0;i<pw.database.types.names["zh-cn"];i++)table+="<option>"+pw.database.types.names["zh-cn"][i]+"</option>";table+="</select></th></tr>",table+='<tr class="advance"><th>个体值总和</th><th colspan=6 style="padding:0"><select id="SumIVs" style=width:100% onChange="CreateURL()">',table+="<option value=-1 selected> </option>",table+="<option value=150 >拥有非常棒的能力(151+)</option>",table+="<option value=120 >拥有相当优秀的能力(121+)</option>",table+="<option value=90 >拥有平均以上的能力(91+)</option>",table+="<option value=0 >拥有还行的能力(90-)</option>",table+="</select></th></tr>",table+='<tr class="advance"><th rowspan=2>最高项个体值</th><th colspan=6 style="padding:0"><select id="HighestIV" style=width:100% onChange="CreateURL()">',table+="<option selected> </option>",table+="<option>拥有最高的力量(31)</option>",table+="<option>拥有很棒的力量(25+)</option>",table+="<option>拥有相当的力量(15+)</option>",table+="<option>拥有还好的力量(14-)</option>",table+="</select></th></tr>",table+='<tr class="advance"><td colspan=6>';for(var i=0;i<=5;i++)table+='<input type="checkbox" class="Highest" onClick="CreateURL()"/> '+["HP","攻击","防御","特攻","特防","速度"][i];table+="</td></tr>",table+='<tr class="advance"><th><input type="button" value="计算所有可能性分布" onclick="CalcDetails();" /></th></td>',table+='<th colspan=6 style=font-weight:normal>计算结果只显示前<input type="text" id="MaxResults" value="100" maxlength="5" style="width:40px;text-align:center">项</th></tr>',table+='<tr class="advance"><td class="details" colspan=7 style="padding:5px;vertical-align:top">',table+='<div style="overflow-y: scroll;height: 100%; width:100%; style=text-align:center">',table+='<div id="details"></div></div></td></tr>',table+='<tr class="toggle"><th colspan="7"><input type="button" style="width:74%;" onclick="$(\'tr.advance\').show();$(\'tr.toggle\').hide();" value="高级选项"><input type="button" style="width:24%;" onclick="calcStats();" value="能力值反查"></th></tr>',table+='<tr><td colspan="7"><input type="text" id="URL" style="width:540px;text-align:left" onfocus="$(this).select();" ></td></tr>',table+="</table>",$(".pw-jscontent").html(table),$("tr.advance").hide();var Working=!1,$BSs=$("input.BS"),$EVs=$("input.EV"),$IVs=$("td.IV"),$Stats=$("input.Stat"),$LV=$("input#LV"),N1=document.getElementsByName("NatureP"),N2=document.getElementsByName("NatureM"),minIVs=[-1,-1,-1,-1,-1,-1],maxIVs=[-1,-1,-1,-1,-1,-1],HP_Value=[1,2,4,8,16,32],hasResults=!1,isUniqueResult=!1,digit=/^\d+$/,formcounts={};for(i=0;i<=802;i++)formcounts[String("00").concat(i).slice(-3)]=0;if($.each(pw.database.pokemon.data[7],function(a,b){var c=a.split(".");formcounts[c[0]]+=1}),window.SelectGen=function(a){var b=1,c=802;switch(parseInt(a)){case 1:b=1,c=151;break;case 2:b=151,c=251;break;case 3:b=252,c=386;break;case 4:b=387,c=493;break;case 5:b=494,c=649;break;case 6:b=650,c=721;break;case 7:b=722,c=802}var d="<option value=0 selected></option>";for(i=b;i<=c;i++)d+="<option value="+i+" >"+String("00").concat(i).slice(-3)+" "+pw.util.getPokemonName(i)+"</option>";$("#pokemon").empty().html(d),SelectPokemon(0)},window.SelectPokemon=function(a){if($("#form").empty(),0==a)$("#Sprite").html("&nbsp;");else{var b=String("00").concat(a).slice(-3),c="";for(i=0;i<formcounts[b];i++){var d=b+"."+String("00").concat(i).slice(-2),e=pw.util.getPokemonName(d);c+="<option value="+d+" >"+(e.form||e.name)+"</option>"}$("#form").html(c),SelectForm(b.concat(".00"))}},window.SelectForm=function(a){var b=parseInt(a.split(".")[0]);$("#Sprite").html('<a href="/wiki/'+pw.util.getPokemonName(b)+'" title="'+pw.util.getPokemonName(b)+'">'+pw.util.createPokemonImage("pgl",a,"width:80%;")+"</a>");var c=rearrangeBaseStats(pw.database.pokemon.data[7][a].basestats);for(i=0;i<=5;i++)$BSs[i].value=c[i];CalcAll()},SelectGen(0),window.SelectEVs=function(a){var b=a.split("/");for(i=0;i<=5;i++)$EVs[i].value=b[i];CalcAll()},window.SelectNature=function(a){var b=a.split("/");if(b[0]==b[1])for(i=0;i<=4;i++)N1[i].checked=!1,N2[i].checked=!1;else N1[b[0]].checked=!0,N2[b[1]].checked=!0;CalcAll()},window.CalcAll=function(){var N=[0,1,1,1,1,1];for(i=0;i<=4&&(!N1[i].checked||!N2[i].checked);i++)N1[i].checked&&(N[i+1]=1.1),N2[i].checked&&(N[i+1]=.9);for(j=0;j<=5;j++)CalcIV(j,$LV.val(),$BSs[j].value,$EVs[j].value,$Stats[j].value,N[j]);isUniqueResult=!0,hasResults=!0;for(var i=0;i<=5;i++)-1==minIVs[i]?(isUniqueResult=!1,hasResults=!1,$IVs[i].innerHTML="?"):minIVs[i]==maxIVs[i]?$Stats[i].value!=CalcStat($LV.val(),$BSs[i].value,$EVs[i].value,minIVs[i],N[j])?($("#HP").html("&nbsp;"),$("#IV_SUM").html("&nbsp;"),$IVs[i].innerHTML="?",isUniqueResult=!1,hasResults=!1):$IVs[i].innerHTML=minIVs[i]:(isUniqueResult=!1,$IVs[i].innerHTML=minIVs[i]+"～"+maxIVs[i]);isUniqueResult?($("#HP").html(pw.database.types.names["zh-cn"][CalcHPType(YtoX(minIVs))]+" "+CalcHPPower(YtoX(minIVs))),$("#IV_SUM").html(eval(minIVs.join("+")))):hasResults?$("#IV_SUM").html(eval(minIVs.join("+"))+"～"+eval(maxIVs.join("+"))):($("#HP").html("&nbsp;"),$("#IV_SUM").html("&nbsp;")),CreateURL()},window.CalcSingle=function(S){var N=1;for(S>0?N1[S-1].checked&&N2[S-1].checked||(N1[S-1].checked&&(N=1.1),N2[S-1].checked&&(N=.9)):N=0,CalcIV(S,$LV.val(),$BSs[S].value,$EVs[S].value,$Stats[S].value,N),-1==minIVs[S]?$IVs[S].innerHTML="?":minIVs[S]==maxIVs[S]?($IVs[S].innerHTML=minIVs[S],$("#IV_SUM").html(eval(minIVs.join("+")))):($IVs[S].innerHTML=minIVs[S]+"～"+maxIVs[S],$("#IV_SUM").html(eval(minIVs.join("+"))+"～"+eval(maxIVs.join("+")))),isUniqueResult=!0,hasResults=!0,i=0;i<=5;i++)-1==minIVs[i]?(isUniqueResult=!1,hasResults=!1):minIVs[i]==maxIVs[i]||(isUniqueResult=!1);minIVs[S]==maxIVs[S]&&$Stats[S].value!=CalcStat($LV.val(),$BSs[S].value,$EVs[S].value,minIVs[S],N)&&($("#HP").html("&nbsp;"),$("#IV_SUM").html("&nbsp;"),$IVs[S].innerHTML="?",isUniqueResult=!1,hasResults=!1),isUniqueResult?($("#HP").html(pw.database.types.names["zh-cn"][CalcHPType(YtoX(minIVs))]+" "+CalcHPPower(YtoX(minIVs))),$("#IV_SUM").html(eval(minIVs.join("+")))):hasResults?$("#IV_SUM").html(eval(minIVs.join("+"))+"～"+eval(maxIVs.join("+"))):($("#HP").html("&nbsp;"),$("#IV_SUM").html("&nbsp;")),CreateURL()},window.CalcDetails=function(){var CheckMax=!1,isMax=[!1,!1,!1,!1,!1,!1];for(i=0;i<=5;i++){if(-1==minIVs[i])return void $("#details").html("<span style=color:red>基础数据不足，无法进行计算。</span>");$(".Highest")[i].checked&&(CheckMax=!0,isMax[i]=!0)}isMax=YtoX(isMax),minIVs=YtoX(minIVs),maxIVs=YtoX(maxIVs);var HPType=$("#HPType")[0].selectedIndex-1,Characteristic=$("#Characteristic")[0].selectedIndex-1,CHRType=Characteristic%6,CHRRank=Math.floor(Characteristic/6),SumIVs=$("#SumIVs")[0].selectedIndex,MaxResults=$("#MaxResults").val(),HighestIV=$("#HighestIV")[0].selectedIndex;0==HighestIV&&(CheckMax=!1);var xHPT;table="<table style=text-align:center align=center><tr><th>HP</th><th>攻击</th><th>防御</th><th>特攻</th><th>特防</th><th>速度</th><th>总和</th><th>觉醒力量属性</th><th>觉醒力量威力</th></tr>";var x=minIVs.slice(0),c=0,i=0;a:for(;;){for(x[0]++,i=0;i<=5;i++)if(x[i]>maxIVs[i]){if(5==i)break a;x[i]=minIVs[i],x[i+1]++}if(xHPT=CalcHPType(x),!(HPType>-1&&xHPT!=HPType)&&(!(Characteristic>-1)||CheckCHR(x,CHRType,CHRRank))){var m=Math.max.apply({},x),s=eval(x.join("+"));switch(SumIVs){case 0:break;case 1:if(s<=150)continue;break;case 2:if(s<=120||s>150)continue;break;case 3:if(s<=90||s>120)continue;break;case 4:if(s>90)continue}if(CheckMax)for(var j=0;j<=5;j++)if(isMax[j]){if(x[j]!=m)continue a;switch(HighestIV){case 1:if(31!=x[j])continue a;break;case 2:if(x[j]<25||31==x[j])continue a;break;case 3:if(x[j]<15||x[j]>=25)continue a;break;case 4:if(x[j]>=15)continue a}}if(table+="<tr>",table+="<td>"+x[0]+"</td><td>"+x[1]+"</td><td>"+x[2]+"</td><td>"+x[4]+"</td><td>"+x[5]+"</td><td>"+x[3]+"</td>",table+="<td>"+s+"</td><td>"+pw.database.types.names["zh-cn"][xHPT]+"</td><td>"+CalcHPPower(x)+"</td>",table+="</tr>",++c==MaxResults)break a}}table+="</table>",$("#details").html(table),minIVs=XtoY(minIVs),maxIVs=XtoY(maxIVs)},window.calcStats=function(){if(0==$("#stats").length){var a="";a+='<table class="colortable colortable-colborder-single colortable-rowborder-single pokemoncolor" id="stats" style="text-align:center;width:560px">',a+="<thead>",a+='<tr><th style="width:200px">个体值</th><th style="width:50px">HP</th><th>攻击</th><th>防御</th><th>特攻</th><th>特防</th><th style="width:50px">速度</th></tr>',a+="</thead>",a+="<tbody></tbody>",a+="</table>",$("div#Calculator").append(a),$("#stats").attr("class",$("#calc").attr("class")),$("#stats").addClass("colortable-colborder-single colortable-rowborder-single")}else $("#stats tbody").empty();var b=$("input#LV").val(),c="",d=new Array,e=new Array;for(S=0;S<=5;S++)for(d[S]=new Array,e[S]=new Array,i=31;i>=0;i--)e[S][i]=1;for(i=31;i>=0;i--)for(S=0;S<=5;S++){var f=1;S>0?N1[S-1].checked&&N2[S-1].checked||(N1[S-1].checked&&(f=1.1),N2[S-1].checked&&(f=.9)):f=0,d[S][i]=CalcStat(b,$("input.BS")[S].value,$("input.EV")[S].value,i,f)}for(i=0;i<31;i++)for(S=0;S<=5;S++)d[S][i]==d[S][i+1]&&(e[S][i+1]+=e[S][i],e[S][i]=0);for(i=31;i>=0;i--){for(c+="<tr>",c+="<td>"+i+"</td>",S=0;S<=5;S++)e[S][i]>0&&(c+='<td rowspan="'+e[S][i]+'">'+d[S][i]+"</td>");c+="</tr>"}$("#stats tbody").html(c),$("#stats td").css("border-right","none")},window.CreateURL=function(){var a="http://www.pokemon.name/w/index.php?title="+mw.config.get("wgPageName");$("#pokemon")[0].selectedIndex>0&&(a+="&pid="+$("#pokemon")[0].selectedIndex),1!=$LV.val()&&(a+="&plv="+$LV.val());for(var b="",c=0;c<=5;c++)b+=","+$Stats[c].value;",,,,,,"!=b&&(a+="&ps="+b.substring(1));for(var d="",c=0;c<=5;c++)d+=","+$EVs[c].value;",0,0,0,0,0,0"!=d&&(a+="&pev="+d.substring(1));for(var e=0,f=0,c=0;c<=4&&(!N1[c].checked||!N2[c].checked);c++)N1[c].checked&&(e=c+1),N2[c].checked&&(f=c+1);e+f>0&&(a+="&pn="+e+","+f),$("#HPType")[0].selectedIndex>0&&(a+="&ph="+$("#HPType")[0].selectedIndex),$("#Characteristic")[0].selectedIndex>0&&(a+="&pc="+$("#Characteristic")[0].selectedIndex),$("#SumIVs")[0].selectedIndex>0&&(a+="&psiv="+$("#SumIVs")[0].selectedIndex),$("#HighestIV")[0].selectedIndex>0&&(a+="&phiv="+$("#HighestIV")[0].selectedIndex);for(var g=$(".Highest"),h="",c=0;c<=5;c++)h+=g[c].checked?"1":"0";"000000"!=h&&(a+="&phiv2="+h),$("#URL").val(a)},window.location.href.indexOf("/w/")>1){var plv=mw.util.getParamValue("plv");null!=plv&&$LV.val(plv);var ps=mw.util.getParamValue("ps");if(null!=ps)for(var ps2=ps.split(","),j=0;j<=5;j++)$Stats[j].value=ps2[j];var pev=mw.util.getParamValue("pev");if(null!=pev)for(var pev2=pev.split(","),j=0;j<=5;j++)$EVs[j].value=pev2[j];var pn=mw.util.getParamValue("pn");if(null!=pn){var pn2=pn.split(",");pn[0]>0&&(N1[pn2[0]-1].checked=!0),pn[1]>0&&(N2[pn2[1]-1].checked=!0)}var ph=mw.util.getParamValue("ph");null!=ph&&($("#HPType")[0].selectedIndex=ph);var pc=mw.util.getParamValue("pc");null!=pc&&($("#Characteristic")[0].selectedIndex=pc);var psiv=mw.util.getParamValue("psiv");null!=psiv&&($("#SumIVs")[0].selectedIndex=psiv);var phiv=mw.util.getParamValue("phiv");null!=phiv&&($("#HighestIV")[0].selectedIndex=phiv);var phiv2=mw.util.getParamValue("phiv2");if(null!=phiv2)for(var j=0;j<=5;j++)$(".Highest")[j].checked=1==phiv2[j];var pid=mw.util.getParamValue("pid");null!=pid&&($("#pokemon")[0].selectedIndex=pid,SelectPokemon(pid))}});