pw.loader.using(["pokemon.js","pokemon.7.js","bootstrap"],function(){function rearrangeBaseStats(a){return[a[0],a[1],a[2],a[4],a[5],a[3]]}function CalcIV(a,b,c,d,e,f){if(!(digit.test(b)&&digit.test(e)&&digit.test(c)&&digit.test(d)))return minIVs[a]=-1,void(maxIVs[a]=-1);if(b=parseInt(b),c=parseInt(c),d=parseInt(d),e=parseInt(e),0==b||0==c||0==e)return minIVs[a]=-1,void(maxIVs[a]=-1);if(1==c)return minIVs[a]=0,void(maxIVs[a]=31);var g=BackCalc(b,c,d,e,f),h=g<0?0:g,j=g>31?31:g;for(i=g+1;i<=31;i++)CalcStat(b,c,d,i,f)==e?j++:i=31;for(i=g-1;i>=0;i--)CalcStat(b,c,d,i,f)==e?h--:i=0;if(h>31||j<0||h<0||j>31)return minIVs[a]=-1,void(maxIVs[a]=-1);minIVs[a]=h,maxIVs[a]=j}function BackCalc(a,b,c,d,e){return 0==e||void 0==e?Math.ceil(100*(d-a-10)/a-2*b-Math.floor(c/4)):Math.ceil(100*(Math.ceil(d/e)-5)/a-2*b-Math.floor(c/4))}function CalcStat(a,b,c,d,e){if(0==a)return 0;if(0==b)return 0;if(1==b)return 1;a=parseInt(a),b=parseInt(b),c=parseInt(c);var f;return 0==e||void 0==e?f=Math.floor((2*b+d+Math.floor(c/4))*a/100+10+a):(f=Math.floor((2*b+d+Math.floor(c/4))*a/100+5),f=Math.floor(f*e)),f}function YtoX(a){return[a[0],a[1],a[2],a[5],a[3],a[4]]}function XtoY(a){return[a[0],a[1],a[2],a[4],a[5],a[3]]}function CalcHPType(a){for(var b=0,c=0;c<=5;c++)a[c]%2==1&&(b+=HP_Value[c]);return Math.floor(15*b/63)+1}function CalcHPPower(a){for(var b=0,c=0;c<=5;c++)a[c]%4>=2&&(b+=HP_Value[c]);return Math.floor(40*b/63)+30}function CheckCHR(a,b,c){var d=Math.max.apply({},a);return a[b]==d&&d%5==c}mw.util.addCSS(".pw-jscontent, .pw-jscontent input.form-control { text-align:center;}.calc-nt1,.calc-nt2 {display:none;}.calc-nt1+label,.calc-nt2+label{font-weight:bold;color:#ccc;border:1px solid #ccc;border-radius:24px;font-size:20px;line-height:100%;padding:3px;margin:0;font-family: monospace;vertical-align: middle;}.calc-nt1:checked+label{background:#f88;color:white;border-color:#f88;}.calc-nt2:checked+label{ background:#88f;color:white;border-color:#88f;}");var n_n=["勤奋","怕寂寞","勇敢","固执","顽皮","大胆","坦率","悠闲","淘气","乐天","胆小","急躁","认真","爽朗","天真","内敛","慢吞吞","冷静","害羞","马虎","温和","温顺","自大","慎重","浮躁"],n_v=["0/0","0/0","0/1","0/2","0/3","0/4","0/0","1/0","1/1","1/2","1/3","1/4","0/0","2/0","2/1","2/2","2/3","2/4","0/0","3/0","3/1","3/2","3/3","3/4","0/0","4/0","4/1","4/2","4/3","4/4"],p_n=["非常喜欢吃东西","经常睡午觉","常常打瞌睡","经常乱扔东西","喜欢悠然自在","以力气大为傲","喜欢胡闹","有点容易生气","喜欢打架","血气方刚","身体强壮","抗打能力强","顽强不屈","能吃苦耐劳","善于忍耐","喜欢比谁跑得快","对声音敏感","冒冒失失","有点容易得意忘形","逃得快","好奇心强","喜欢恶作剧","做事万无一失","经常思考","一丝不苟","性格强势","有一点点爱慕虚荣","争强好胜","不服输","有一点点固执"],html='<div class="card border-primary shuffledex"><div class="card-header border-primary bg-primary"><div class="nav nav-tabs card-header-tabs">\t<a class="nav-item nav-link calc-tab active" data-toggle="tab" href="#calc-tab">个体值计算器</a></div></div><div class="card-body"><div class="container-fluid"><div class="tab-content"><div class="tab-pane fade show active" id="calc-tab"><div class="row">\t\t<div class="col-12 col-lg-3">\t\t<div class="form-group"><label>宝可梦</label></div>\t\t<div class="form-group row"><div class="col-12 calc-sprite"></div></div>\t\t<div class="form-group row">\t\t<div class="col-8"><select class="form-control calc-selectPokemon" /></div>\t\t<div class="col-4"><select class="form-control calc-selectForm" /></div>\t\t</div>\t\t</div>\t\t<div class="col-12 col-lg-9">\t\t<div class="form-group row"><label class="col-1">能力</label><label class="col-2">种族值</label><label class="col-2">努力值</label><label class="col-2">性格</label><label class="col-2">能力值</label><label class="col-3">个体值</label></div>'+function(){var a="";for(i=0;i<=5;i++)a+='<div class="form-group row"><label class="col-1">'+["HP","攻击","防御","特攻","特防","速度"][i]+'</label><div class="col-2"><input type="text" class="form-control calc-bs" value="0" maxlength="3"></div><div class="col-2"><input type="text" class="form-control calc-ev" value="0" maxlength="3"></div><div class="col-2">'+(0==i?"":'<input type="radio" class="form-check-input calc-nt1 " name="nature1" id="n1'+(i-1)+'" value="'+(i-1)+'"><label for="n1'+(i-1)+'">＋</label>　<input type="radio" class="form-check-input calc-nt2" id="n2'+(i-1)+'" name="nature2" value="'+(i-1)+'"><label for="n2'+(i-1)+'">－</label>')+'</div><div class="col-2"><input type="text" class="form-control calc-stat" value="0" maxlength="3"></div><div class="col-3"><input type="text" class="form-control calc-iv" value="0" maxlength="3"></div></div>';return a}()+'<div class="form-group row"><label class="col-1">等级</label><div class="col-2"><input type="text" class="form-control calc-level" value="1" maxlength="3"></div><div class="col-2"><select class="form-control calc-selectEV"><option value="0/0/0/0/0/0" selected>全0</option><option value="252/0/0/0/0/252">HP速度252</option><option value="0/252/0/0/0/252">攻击速度252</option><option value="0/0/0/252/0/252">特攻速度252</option><option value="252/0/252/0/0/0">HP防御252</option><option value="252/0/0/0/252/0">HP特防252</option><option value="0/0/252/0/252/0">防御特防252</option><option value="252/252/252/252/252/252">全满</option></select></div><div class="col-2"><select class="form-control calc-selectNature">'+function(){var a="";for(i=0;i<n_n.length;i++)a+='<option value="'+n_v[i]+'">'+n_n[i]+"</option>";return a}()+"</select></div>";$(".pw-jscontent").html(html),$("tr.advance").hide();var Working=!1,$BSs=$(".calc-bs"),$EVs=$(".calc-ev"),$IVs=$(".calc-iv"),$Stats=$(".calc-stat"),$LV=$(".calc-level"),N1=$(".calc-nt1"),N2=$(".calc-nt2"),minIVs=[-1,-1,-1,-1,-1,-1],maxIVs=[-1,-1,-1,-1,-1,-1],HP_Value=[1,2,4,8,16,32],hasResults=!1,isUniqueResult=!1,digit=/^\d+$/,formcounts={};if($.each(pw.database.pokemon.data[7],function(a,b){var c=a.split(".");formcounts[c[0]]=1+(formcounts[c[0]]||0)}),SelectGen=function(a){var b=1,c=807,d='<option value="0" selected></option>';for(i=b;i<=c;i++)d+='<option value="'+i+'" >'+String("00").concat(i).slice(-3)+" "+pw.util.getPokemonName(i)+"</option>";$(".calc-selectPokemon").empty().html(d),SelectPokemon(1)},SelectPokemon=function(a){if($(".calc-selectForm").empty(),0==a)$(".calc-sprite").html("&nbsp;");else{var b=String("00").concat(a).slice(-3),c="";for(i=0;i<formcounts[b];i++){var d=b+"."+String("00").concat(i).slice(-2),e=pw.util.getPokemonName(d);c+="<option value="+d+" >"+(e.form||e.name)+"</option>"}$(".calc-selectForm").html(c),SelectForm(b.concat(".00"))}},SelectForm=function(a){var b=parseInt(a.split(".")[0]);$(".calc-sprite").html('<a href="/wiki/'+pw.util.getPokemonName(b)+'" title="'+pw.util.getPokemonName(b)+'">'+pw.util.createPokemonImage("pgl",a,"width:80%;")+"</a>");var c=rearrangeBaseStats(pw.database.pokemon.data[7][a].basestats);for(i=0;i<=5;i++)$BSs[i].value=c[i]},SelectEVs=function(a){var b=a.split("/");for(i=0;i<=5;i++)$EVs[i].value=b[i];CalcAll()},SelectNature=function(a){var b=a.split("/");if(b[0]==b[1])for(i=0;i<=4;i++)N1[i].checked=!1,N2[i].checked=!1;else N1[b[0]].checked=!0,N2[b[1]].checked=!0;CalcAll()},CalcAll=function(){var N=[0,1,1,1,1,1];for(i=0;i<=4&&(!N1[i].checked||!N2[i].checked);i++)N1[i].checked&&(N[i+1]=1.1),N2[i].checked&&(N[i+1]=.9);for(j=0;j<=5;j++)CalcIV(j,$LV.val(),$BSs[j].value,$EVs[j].value,$Stats[j].value,N[j]);isUniqueResult=!0,hasResults=!0;for(var i=0;i<=5;i++)-1==minIVs[i]?(isUniqueResult=!1,hasResults=!1,$IVs[i].value="?"):minIVs[i]==maxIVs[i]?$IVs[i].value=minIVs[i]:(isUniqueResult=!1,$IVs[i].value=minIVs[i]+"～"+maxIVs[i]);isUniqueResult?($("#HP").html(pw.database.types.names["zh-cn"][CalcHPType(YtoX(minIVs))]+" "+CalcHPPower(YtoX(minIVs))),$("#IV_SUM").html(eval(minIVs.join("+")))):hasResults?$("#IV_SUM").html(eval(minIVs.join("+"))+"～"+eval(maxIVs.join("+"))):($("#HP").html("&nbsp;"),$("#IV_SUM").html("&nbsp;")),CreateURL()},CalcDetails=function(){var CheckMax=!1,isMax=[!1,!1,!1,!1,!1,!1];for(i=0;i<=5;i++){if(-1==minIVs[i])return void $("#details").html("<span style=color:red>基础数据不足，无法进行计算。</span>");$(".Highest")[i].checked&&(CheckMax=!0,isMax[i]=!0)}isMax=YtoX(isMax),minIVs=YtoX(minIVs),maxIVs=YtoX(maxIVs);var HPType=$("#HPType")[0].selectedIndex-1,Characteristic=$("#Characteristic")[0].selectedIndex-1,CHRType=Characteristic%6,CHRRank=Math.floor(Characteristic/6),SumIVs=$("#SumIVs")[0].selectedIndex,MaxResults=$("#MaxResults").val(),HighestIV=$("#HighestIV")[0].selectedIndex;0==HighestIV&&(CheckMax=!1);var xHPT;table="<table style=text-align:center align=center><tr><th>HP</th><th>攻击</th><th>防御</th><th>特攻</th><th>特防</th><th>速度</th><th>总和</th><th>觉醒力量属性</th><th>觉醒力量威力</th></tr>";var x=minIVs.slice(0),c=0,i=0;a:for(;;){for(x[0]++,i=0;i<=5;i++)if(x[i]>maxIVs[i]){if(5==i)break a;x[i]=minIVs[i],x[i+1]++}if(xHPT=CalcHPType(x),!(HPType>-1&&xHPT!=HPType)&&(!(Characteristic>-1)||CheckCHR(x,CHRType,CHRRank))){var m=Math.max.apply({},x),s=eval(x.join("+"));switch(SumIVs){case 0:break;case 1:if(s<=150)continue;break;case 2:if(s<=120||s>150)continue;break;case 3:if(s<=90||s>120)continue;break;case 4:if(s>90)continue}if(CheckMax)for(var j=0;j<=5;j++)if(isMax[j]){if(x[j]!=m)continue a;switch(HighestIV){case 1:if(31!=x[j])continue a;break;case 2:if(x[j]<25||31==x[j])continue a;break;case 3:if(x[j]<15||x[j]>=25)continue a;break;case 4:if(x[j]>=15)continue a}}if(table+="<tr>",table+="<td>"+x[0]+"</td><td>"+x[1]+"</td><td>"+x[2]+"</td><td>"+x[4]+"</td><td>"+x[5]+"</td><td>"+x[3]+"</td>",table+="<td>"+s+"</td><td>"+pw.database.types.names["zh-cn"][xHPT]+"</td><td>"+CalcHPPower(x)+"</td>",table+="</tr>",++c==MaxResults)break a}}table+="</table>",$("#details").html(table),minIVs=XtoY(minIVs),maxIVs=XtoY(maxIVs)},calcStats=function(){if(0==$("#stats").length){var a="";a+='<table class="colortable colortable-colborder-single colortable-rowborder-single pokemoncolor" id="stats" style="text-align:center;width:560px">',a+="<thead>",a+='<tr><th style="width:200px">个体值</th><th style="width:50px">HP</th><th>攻击</th><th>防御</th><th>特攻</th><th>特防</th><th style="width:50px">速度</th></tr>',a+="</thead>",a+="<tbody></tbody>",a+="</table>",$("div#Calculator").append(a),$("#stats").attr("class",$("#calc").attr("class")),$("#stats").addClass("colortable-colborder-single colortable-rowborder-single")}else $("#stats tbody").empty();var b=$("input#LV").val(),c="",d=new Array,e=new Array;for(S=0;S<=5;S++)for(d[S]=new Array,e[S]=new Array,i=31;i>=0;i--)e[S][i]=1;for(i=31;i>=0;i--)for(S=0;S<=5;S++){var f=1;S>0?N1[S-1].checked&&N2[S-1].checked||(N1[S-1].checked&&(f=1.1),N2[S-1].checked&&(f=.9)):f=0,d[S][i]=CalcStat(b,$("input.BS")[S].value,$("input.EV")[S].value,i,f)}for(i=0;i<31;i++)for(S=0;S<=5;S++)d[S][i]==d[S][i+1]&&(e[S][i+1]+=e[S][i],e[S][i]=0);for(i=31;i>=0;i--){for(c+="<tr>",c+="<td>"+i+"</td>",S=0;S<=5;S++)e[S][i]>0&&(c+='<td rowspan="'+e[S][i]+'">'+d[S][i]+"</td>");c+="</tr>"}$("#stats tbody").html(c),$("#stats td").css("border-right","none")},CreateURL=function(){return""},window.location.href.indexOf("/w/")>1){var plv=mw.util.getParamValue("plv");null!=plv&&$LV.val(plv);var ps=mw.util.getParamValue("ps");if(null!=ps)for(var ps2=ps.split(","),j=0;j<=5;j++)$Stats[j].value=ps2[j];var pev=mw.util.getParamValue("pev");if(null!=pev)for(var pev2=pev.split(","),j=0;j<=5;j++)$EVs[j].value=pev2[j];var pn=mw.util.getParamValue("pn");if(null!=pn){var pn2=pn.split(",");pn[0]>0&&(N1[pn2[0]-1].checked=!0),pn[1]>0&&(N2[pn2[1]-1].checked=!0)}var ph=mw.util.getParamValue("ph");null!=ph&&($("#HPType")[0].selectedIndex=ph);var pc=mw.util.getParamValue("pc");null!=pc&&($("#Characteristic")[0].selectedIndex=pc);var psiv=mw.util.getParamValue("psiv");null!=psiv&&($("#SumIVs")[0].selectedIndex=psiv);var phiv=mw.util.getParamValue("phiv");null!=phiv&&($("#HighestIV")[0].selectedIndex=phiv);var phiv2=mw.util.getParamValue("phiv2");if(null!=phiv2)for(var j=0;j<=5;j++)$(".Highest")[j].checked=1==phiv2[j];var pid=mw.util.getParamValue("pid");null!=pid&&($("#pokemon")[0].selectedIndex=pid,SelectPokemon(pid))}SelectGen(0),$(".calc-selectPokemon").change(function(){SelectPokemon(this.value)}),$(".calc-selectForm").change(function(){SelectForm(this.value)}),$(".pw-jscontent input").change(CalcAll)});