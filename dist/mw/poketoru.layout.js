poketoruBoard={defaultIconWidth:"32px",iconSrc:{block:"/w/images/6/6f/Shuffle_Block.png",rock:"/w/images/b/bc/Shuffle_Rock.png",barrier:"/w/images/d/d9/Shuffle_Barrier.png",cloud:"/w/images/9/9f/Shuffle_Cloud.png",coin:"/w/images/a/a8/Shuffle_Coin.png",clear:"/w/images/a/a5/Shuffle_Clearing.png",a:"/w/images/b/b1/Shuffle_Icon_A.png",b:"/w/images/a/a8/Shuffle_Icon_B.png",c:"/w/images/2/28/Shuffle_Icon_C.png",d:"/w/images/7/7c/Shuffle_Icon_D.png",e:"/w/images/4/49/Shuffle_Icon_E.png"},arrowSvg:'<svg width="{w}px" height="{h}px" style="position: absolute; top: 0; left: 0;"><defs><marker id="arrow" markerWidth="10" markerHeight="10" refX="6" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,1 L0,5 L6,3 z" fill="#f00" /></marker></defs><line x1="{x1}" y1="{y1}" x2="{x2}" y2="{y2}" stroke="#f00" stroke-width="4" marker-end="url(#arrow)" /></svg>',coverIcons:["barrier","cloud","clear","area","drag","drop","switch"],createIcon:function(a,b){a=a.toLowerCase();var c="";if(a in poketoruBoard.iconSrc)c=poketoruBoard.iconSrc[a];else if(1==a.length){var d=("0"+(a.charCodeAt()-"a".charCodeAt())).slice(-2);c=pw.util.getResUrl("/sprites/side/shuffle/pokemon/201."+d+".png")}else{var e=a.split("."),f=("00"+e[0]).slice(-3),d=1==e.length?"00":("0"+e[1]).slice(-2);c=pw.util.getResUrl("/sprites/side/shuffle/pokemon/"+f+"."+d+".png")}return c?'<img class="shuffleboard-'+a+'" src="'+c+'" style="width:'+b+";height:"+b+';"/>':'<div class="shuffleboard-'+a+'" style="width:'+b+";height:"+b+';"/>'},createBoard:function(a,b,c){for(var d=a[0].length<6?6:a[0].length,e=d-6,f=parseInt(b.replace("px",""),10),g=new Array(d),h=0;h<d;h++){g[h]=new Array(6);for(var i=0;i<6;i++)if(g[h][i]=[],a[0].length>=h&&a[0][h]){var j=a[0][h][i].trim().toLowerCase();j.length>0&&(g[h][i]=j.split(","))}}if(2==a.length)for(var h=0;h<a[1].length;h++)for(var i=0;i<6;i++){var j=a[1][h][i].trim().toLowerCase();j.length>0&&g[h+e][i].push(j)}var k="";k+='<div class="shuffleboard-wrapper"><table>';for(var l,m,n,o,h=c?0:e;h<d;h++){k+="<tr>";for(var i=0;i<6;i++){k+='<td><div class="'+(0==g[h][i].length||$.inArray(g[h][i][0],poketoruBoard.coverIcons)>-1?"shuffleboard-empty":"")+'" style="width:'+b+";height:"+b+';">';for(var p=0;p<g[h][i].length;p++){var q=g[h][i][p];if("area"==q){var r="";h!=d-1&&-1!=$.inArray("area",g[h+1][i])||(r+="shuffleboard-area-bottom "),0!=h&&-1!=$.inArray("area",g[h-1][i])||(r+="shuffleboard-area-top "),5!=i&&-1!=$.inArray("area",g[h][i+1])||(r+="shuffleboard-area-right "),0!=i&&-1!=$.inArray("area",g[h][i-1])||(r+="shuffleboard-area-left "),k+='<div class="shuffleboard-area '+r+'" style="width:'+b+";height:"+b+';"/>'}else"drag"==q||"drop"==q||"switch"==q?(k+='<div class="shuffleboard-area shuffleboard-'+q+'" style="width:'+b+";height:"+b+';"/>',"drag"==q?(l=(i+.5)*(f+1)+3,m=(h+.5)*(f+1)):"drop"==q&&(n=(i+.5)*(f+1)+3,o=(h+.5)*(f+1))):k+=poketoruBoard.createIcon(q,b)}k+="</div></td>"}k+="</tr>",c&&h==e-1&&(k+='<tr><td colspan="6"><hr></td></tr>')}return k+="</table>",l&&m&&n&&o&&(k+=poketoruBoard.arrowSvg.replace("{w}",6*(f+1)).replace("{h}",6*(f+1)).replace("{x1}",l).replace("{y1}",m).replace("{x2}",n).replace("{y2}",o)),k+="</div>",$table=$(k),$table},init:function(){mw.util.addCSS("\t\t.shuffleboard-wrapper { border: 1px solid #ccc; border-radius: 0.5em; overflow: hidden; display: inline-block; margin:auto; }\t\t.shuffleboard-wrapper table { border-collapse:collapse; }\t\t.shuffleboard-wrapper td { border: 1px solid #f2f2f2; padding: 0; background: none; }\t\t.shuffleboard-wrapper div { text-align: left; }\t\t.shuffleboard-wrapper img { position: absolute; width: 100%; height: 100%; }\t\t.shuffleboard-expand { text-align: center; cursor: pointer; font-size:small; }\t\t.shuffleboard:hover .shuffleboard-cloud { opacity:0.5; filter:alpha(opacity=50); }\t\t.shuffleboard-drag { background-color: #faa; }\t\t.shuffleboard-drop { background-color: #aaf; }\t\t.shuffleboard-switch { background-color: #afa; }\t\t.shuffleboard-area-top { border-top: 1px red dashed; }\t\t.shuffleboard-area-bottom { border-bottom: 1px red dashed; }\t\t.shuffleboard-area-left { border-left: 1px red dashed; }\t\t.shuffleboard-area-right { border-right: 1px red dashed; }\t\t.shuffleboard-empty { background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTAwMTZFREJBNTU4MTFFNTk5MTJDRDdDM0M3QzE3MjciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QTAwMTZFRENBNTU4MTFFNTk5MTJDRDdDM0M3QzE3MjciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBMDAxNkVEOUE1NTgxMUU1OTkxMkNEN0MzQzdDMTcyNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBMDAxNkVEQUE1NTgxMUU1OTkxMkNEN0MzQzdDMTcyNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pj+Z5DwAAAOtSURBVHja7JZbSJNhGMefzc0dc56m4gGmbPMETgQ1B9EUBVM2l5heBBoEdmOXdRd0nXWXKHgThHiTkU0bXWWCmCBOEQ+tTTfPTtRtbnM6D/3fYdcGXyDEPhD127f3/T3/5//83493eXlJN3nx6YavGEAMIAYguO6B4eFhOj09JYFAQMnJyRQXF0der1d7eHioOj4+Vp6cnPDOz889xcXFLtyz22w2CgaD1N7ezp6j2tpabgDsOjs7I7lcziDUExMTTVtbW7cSExNJJBKRRCKhcDisHhkZ0efl5fl1Ot3H9fV1F4Pm8XjcFVAoFCSTyQiVlg0ODpqkUinp9frvUMKWmprqxX0KhUKJBQUFpXNzcwa32/3IaDR+vri4mGGfcfZAf38/qz5zbGzMlJCQEDKZTG9ycnK+ORwObyAQiMoMAC9gxgD2Gs/6oIYJquT+jQLXAkBW/vj4+EOxWExms7kHmx2hFeKkpCQz2vFyYWHhBVpx3263i/r6+gLoeS9rz+TkZFtKSgqPM0BdXZ1md3dXptFoLKgqmJaWJsTiXVNTU6WACsIDYavVqvN4PF0tLS2Co6OjsEql+uT3+8XwSj5nAEitYdUrlcptVKpYWlpqmZ2dlXd0dFhLSkq6fT5fd2tr69eVlZVb+PwBABVolYeZdm1tTc3ZhFhUtLq6SpFIpJONIDYirVbLNpiqrKwkwLBJmIT7dQMDA/nsggFpZ2eHsrKy4jkDwGg8lgFsrJgSV3lwubi4SGwiysrKCP2P5gP7YRcDiI+Pp4ODgzjOANgwBNdTU1PTO/x7uLy8fA8eKEhPT7+NDX5kZGTQ3t5exczMTEZzc/NPtOALPJOALHiMl50QZ4Dc3FwH+l6BKlOEQqELsg7BkE8BUQ+Z7yAFyeVyyZCEAUB9wFciUEsNCGpsbPz1L84CB2Y8PD8/b4QR5fBDpKampgcb2gAlQYsk5eXltuzs7LeYhAieEQPICGVOMRGO6xbnXfdOODo6Sqg8E7874e5AVVVVL9zNxo+ZMeoJtsb09DShVVKcBU8AokD17xFEzvr6em4KbG5uEkZtq6GhYRg5IIf0z7a3tw1FRUXJgKGruMVQyO8isJ7j3FBUV1db9vf3nX9MyckDzNFsIchtQ9QeoLo2p9NpwClpQBJGAVgkA44QQH5UPYS/3VCNEETcARCnxOfzo4cS1HDDaK8KCwu1gFBtbGwo0RY+oteDe6uIZbvFYmGRHf0eg+DsgdgrWQwgBvDfA/wWYAANy8993yhYoAAAAABJRU5ErkJggg==') center center no-repeat; background-size: 100% 100%; }\t\t#shuffleboard-dialog { max-height: 800px; }"),$(".shuffleboard").each(function(){var a=$(this);if(!a.data("default"))return!0;var b=a.data("iconwidth")&&a.data("iconwidth").match(/^\d+px$/i)?a.data("iconwidth"):poketoruBoard.defaultIconWidth;try{var c=$.parseJSON("["+a.data("default").replace(/'/g,'"')+"]")}catch(a){return!0}var d=poketoruBoard.createBoard(c,b,!1);if(a.html(d),c[0].length>6){var e=$('<div class="shuffleboard-expand">展开</div>');e.click(function(){pw.loader.using("jqueryui",function(){0==$("#shuffleboard-dialog").length&&$("body").append('<div id="shuffleboard-dialog" title="完整布局"></div>');var a=$("#shuffleboard-dialog");a.html(poketoruBoard.createBoard(c,b,!0)),a.dialog({width:300,modal:!0,height:"auto"}),a.scrollTop(a.prop("scrollHeight"))})}),a.append(e)}a.addClass("shuffleboard-done")})}},poketoruBoard.init();