mw.util.addCSS('.shuffle-dri{background:url("/w/images/thumb/b/b5/Shuffle_Drop_Rate_Increase.png/20px-Shuffle_Drop_Rate_Increase.png");width:20px;height:20px;position: absolute;top: 0;right: 0;margin: 6px 6px 0 0; z-index: 2;}');for(var html='<div class="container"><div class="row">\t<div class="pw-calculator col-lg-6">\t\t<form class="form-horizontal" role="form">\t\t\t<div class="form-group">\t\t\t\t<label class="col-2 control-label">掉落几率</label>',j=0;j<=2;j++){html+='\t\t\t<div class="col-3">\t\t\t\t<select class="form-control" name="shuffle-droprate'+j+'" onchange="calc()">';for(var droprateText=["-","100%","50%","25%","12.5%","6.25%","3.125%","1.56%"],i=0;i<8;i++)html+="<option value="+i+">"+droprateText[i]+"</option>";html+="\t\t\t\t</select>\t\t\t\t</div>"}if(html+='\t\t\t</div>\t\t\t<div class="form-group">\t\t\t\t<label class="col-2 control-label">所需经验</label>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-guage" onchange="calc()">\t\t\t\t</div>\t\t\t</div>\t\t\t<div class="form-group">\t\t\t\t<label class="col-2 control-label">每局花费</label>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-cost" onchange="calc()">\t\t\t\t</div>\t\t\t</div>\t\t<hr>\t\t\t<div class="form-group">\t\t\t\t<label class="col-2 control-label">平均掉落几率</label>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-drop" disabled>\t\t\t\t</div>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-drop-dri" disabled><div class="shuffle-dri"></div>\t\t\t\t</div>\t\t\t</div>\t\t\t<div class="form-group">\t\t\t\t<label class="col-2 control-label">需要局数</label>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-totalplay" disabled>\t\t\t\t</div>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-totalplay-dri" disabled><div class="shuffle-dri"></div>\t\t\t\t</div>\t\t\t</div>\t\t\t<div class="form-group">\t\t\t\t<label class="col-2 control-label">需要花费</label>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-totalcost" disabled>\t\t\t\t</div>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-totalcost-dri" disabled><div class="shuffle-dri"></div>\t\t\t\t</div>\t\t\t</div>\t\t<hr>\t\t\t<div class="form-group">\t\t\t\t<label class="col-2 control-label">掉落0个几率</label>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-drop0" disabled>\t\t\t\t</div>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-drop0-dri" disabled><div class="shuffle-dri"></div>\t\t\t\t</div>\t\t\t</div>\t\t\t<div class="form-group">\t\t\t\t<label class="col-2 control-label">掉落1个几率</label>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-drop1" disabled>\t\t\t\t</div>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-drop1-dri" disabled><div class="shuffle-dri"></div>\t\t\t\t</div>\t\t\t</div>\t\t\t<div class="form-group">\t\t\t\t<label class="col-2 control-label">掉落2个几率</label>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-drop2" disabled>\t\t\t\t</div>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-drop2-dri" disabled><div class="shuffle-dri"></div>\t\t\t\t</div>\t\t\t</div>\t\t\t<div class="form-group">\t\t\t\t<label class="col-2 control-label">掉落3个几率</label>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-drop3" disabled>\t\t\t\t</div>\t\t\t\t<div class="col-3">\t\t\t\t<input class="form-control" type="textbox" name="shuffle-drop3-dri" disabled><div class="shuffle-dri"></div>\t\t\t\t</div>\t\t\t</div>\t\t</form>\t</div></div></div>',$("#shuffle-calculator").html(html),window.calcDroprate=function(a,b,c){var d=0;if(a>0){var e=1/Math.pow(2,a-1);b>1&&(e=1-Math.pow(1-e,b)),d+=e}return d},window.calcDroprates=function(a,b,c){var d=0;return $.each(a,function(a,c){if(c>0){var e=1/Math.pow(2,c-1);b>1&&(e=1-Math.pow(1-e,b)),d+=e}}),d},window.calcDropCounts=function(a,b,c){var d=calcDroprate(a[0],b,c),e=calcDroprate(a[1],b,c),f=calcDroprate(a[2],b,c);return[(1-d)*(1-e)*(1-f),d+e+f-2*(d*e+e*f+d*f-3*d*e*f)-3*d*e*f,d*e+e*f+d*f-3*d*e*f,d*e*f]},window.calc=function(){var a=parseInt($("select[name=shuffle-droprate0]").val()),b=parseInt($("select[name=shuffle-droprate1]").val()),c=parseInt($("select[name=shuffle-droprate2]").val()),d=parseInt($("input[name=shuffle-guage]").val())||0,e=parseInt($("input[name=shuffle-cost]").val())||0,f=calcDroprates([a,b,c],1),g=calcDroprates([a,b,c],2),h=calcDropCounts([a,b,c],1),i=calcDropCounts([a,b,c],2);$("input[name=shuffle-drop]").val(f.toFixed(2)+"个/局"),$("input[name=shuffle-totalplay]").val(Math.ceil(d/f)),$("input[name=shuffle-totalcost]").val(Math.ceil(d/f)*e),$("input[name=shuffle-counts]").val(calcDropCounts([a,b,c],2)),$("input[name=shuffle-drop-dri]").val(g.toFixed(2)+"个/局"),$("input[name=shuffle-totalplay-dri]").val(Math.ceil(d/g)),$("input[name=shuffle-totalcost-dri]").val(Math.ceil(d/g)*e);for(var j=0;j<=3;j++)$("input[name=shuffle-drop"+j+"]").val((100*h[j]).toFixed(2)+"%"),$("input[name=shuffle-drop"+j+"-dri]").val((100*i[j]).toFixed(2)+"%")},mw.util.getParamValue("dr")){var dr=mw.util.getParamValue("dr").split(",");for(i=0;i<dr.length;i++)$("select[name=shuffle-droprate"+i+"]").val(parseInt(dr[i]));calc()}